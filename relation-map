#! /bin/bash

write-dot-file.rkt "$1" > $1.dot

maphtml.sh $1.dot $1.html

function get_line () {
    head -$2 $1.dot | tail -1
}

for linenum in `grep -n '^\s*"[^"]*" \[' $1.dot | awk -F : '{print $1}'`
do
    line=`get_line $1 $linenum`
    name=`echo $line | grep -o '"[^"]*"' | head -1 | sed 's/"//g'`
    url=`echo $line | grep -o '"[^"]*"' | tail -1 | sed 's/"//g'`
    cp blank.html $url
    sed -i "s/\$TITLE/$name/g" $url
done
